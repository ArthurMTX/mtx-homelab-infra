services:
  web:
    image: php:7.4-apache
    container_name: apache-web
    restart: always

    volumes:
      - "{{ docker_config_root }}/apache/web:/var/www/html"

    environment:
      APACHE_DOCUMENT_ROOT: /var/www/html

    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.web.rule=Host(`{{ apache_hostname }}`)"
      - "traefik.http.routers.web.entrypoints=websecure"
      - "traefik.http.routers.web.tls.certresolver=lets-encrypt"
      - "traefik.http.routers.web.tls=true"
      - "traefik.http.services.web.loadBalancer.server.port={{ ports.apache.http }}"

    networks:
      - web

networks:
  web:
    external: true
