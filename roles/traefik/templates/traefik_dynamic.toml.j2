[http.middlewares.simpleAuth.basicAuth]
  users = [
{% for user in traefik_simpleauth_users %}
    "{{ user }}"{% if not loop.last %},{% endif %}
{% endfor %}
  ]

[http.middlewares.vpnAuth.basicAuth]
  users = [
{% for user in traefik_vpnauth_users %}
    "{{ user }}"{% if not loop.last %},{% endif %}
{% endfor %}
  ]

[http.middlewares.crowdsec-bouncer.forwardAuth]
  address = "http://crowdsec-bouncer:8080/api/v1/forwardAuth"
  trustForwardHeader = true

[http.routers.api]
  rule = "Host(`{{ traefik_hostname }}`)"
  entrypoints = ["websecure"]
  middlewares = ["crowdsec-bouncer", "simpleAuth"]
  service = "api@internal"
  [http.routers.api.tls]
    certResolver = "lets-encrypt"

[http.routers.vpn]
  rule = "Host(`{{ vpn_hostname }}`)"
  entrypoints = ["websecure"]
  middlewares = ["vpnAuth"]
  service = "vpnService"
  [http.routers.vpn.tls]
    certResolver = "lets-encrypt"
